/*!
 * ng-daterangepicker.js
 * https://github.com/yuyaohshimo/ng-daterangepicker
 *
 * Copyright (c) 2015 Yuya Ohshimo
 * Licensed under the MIT license.
 */
angular.module("dateRangePicker",[]).factory("dateRangePickerService",[function(){var e=function(e){for(var t=moment().month(e).startOf("month").day(),n=moment().month(e).endOf("month").date(),a=6-moment().month(e).endOf("month").day(),o=moment().month(e-1).endOf("month").format("D"),r=[];t>0;)r.push({value:o-t+1,disabled:!0}),t--;for(var l=1;n>=l;l++)r.push({value:l,disabled:!1});for(var d=1;a>=d;d++)r.push({value:d,disabled:!0});return r},t=function(e){var t=e.clone().endOf("month");return moment().month()+t.diff(moment().endOf("month"),"month")},n=function(e,t,n,a,o){var r="start"===o?e.month:this.getMonthValue(e.value),l="end"===o?t.month:this.getMonthValue(t.value);return moment().clone().month(r).date(n)<=moment().clone().month(l).date(a)},a=function(e){var t;return e.forEach(function(e){return e.selected?void(t=e):void 0}),t},o=function(e){return"start"===e?"end":"start"},r=function(e){for(var t=7,n=[],a=0;a<Math.ceil(e.length/t);a++){var o=a*t;n.push(e.slice(o,o+t))}return n};return{getMonth:e,getMonthValue:t,isValidDay:n,getInitialOption:a,getOppositeType:o,getDaysPerWeek:r}}]).controller("dateRangePickerController",["$scope","dateRangePickerService",function(e,t){e.locale&&moment.locale("dateRangePicker",{months:e.locale.months||moment.months(),weekdaysShort:e.locale.weekdaysShort||moment.weekdaysShort()}),e.applyButtonLabel=e.applyButtonLabel||"Apply",e._moment=moment(),e.start={value:e.initialRange?e.initialRange.start:moment(),month:e.initialRange?t.getMonthValue(e.initialRange.start):moment().month(),show:!1},e.end={value:e.initialRange?e.initialRange.end:moment(),month:e.initialRange?t.getMonthValue(e.initialRange.end):moment().month(),show:!1},e.start.days=t.getDaysPerWeek(t.getMonth(e.start.month)),e.end.days=t.getDaysPerWeek(t.getMonth(e.end.month)),e.selectedOption=t.getInitialOption(e.options),e.weeks=moment.weekdaysShort(),e.onChangeSelect=function(){if("custom"!==e.selectedOption.value){if("all"===e.selectedOption.value)return e.applyDate(!0);e.start.value=e.selectedOption.start,e.start.month=t.getMonthValue(e.start.value),e.start.days=t.getDaysPerWeek(t.getMonth(e.start.month)),e.end.value=e.selectedOption.end,e.end.month=t.getMonthValue(e.end.value),e.end.days=t.getDaysPerWeek(t.getMonth(e.end.month)),e.applyDate()}},e.onSelectDay=function(n,a,o,r){if(!a.disabled&&t.isValidDay(e.start,e.end,o,r,n)){var l=e[n].month;e[n].value=moment().month(l).date(a.value),e[n].show=!1,e.resetMonth(n)}},e.onChangeMonth=function(n,a){e[n].month+=a,e[n].days=t.getDaysPerWeek(t.getMonth(e[n].month))},e.toggleDropdown=function(n,a){n.stopPropagation();var o=t.getOppositeType(a);e[o].show=!1,e.resetMonth(o),e[a].show=!e[a].show,e[a].show||e.resetMonth(a)},e.applyDate=function(t){var n=e.start,a=e.end;n.value._d&&a.value._d&&(t&&(n=null,a=null),e.applyDateRange({start:n,end:a,option:e.selectedOption}))},e.resetMonth=function(n){e[n].month=t.getMonthValue(e[n].value)},e.getMonthValue=function(e){return t.getMonthValue(e)}}]).directive("dateRangePicker",["$window",function(e){return{restrict:"AE",replace:!0,template:'<div class="daterangepicker"><div class="daterangepicker__option"><select ng-model="selectedOption" ng-options="option.label for option in options" ng-change="onChangeSelect()"></select></div><div ng-show="selectedOption.value === \'custom\'" class="daterangepicker__cutom"><div class="daterangepicker__start"><input ng-if="useBrowserDefault" type="date" ng-model="start.value._d" class="daterangepicker__input"/><input ng-if="!useBrowserDefault" type="text" ng-value="start.value.format(format.date)" ng-click="toggleDropdown($event, \'start\')" readonly="" class="daterangepicker__input"/><div ng-show="start.show" ng-if="!useBrowserDefault" ng-click="$event.stopPropagation()" class="daterangepicker__dropdown"><button ng-click="onChangeMonth(\'start\', -1)" class="daterangepicker__prev">&lt;</button><button ng-click="onChangeMonth(\'start\', 1)" ng-if="start.month &lt; end.month" class="daterangepicker__next">&gt;</button><div class="daterangepicker__calendars"><h4><div class="daterangepicker__year">{{ _moment.clone().month(start.month).format(locale.year || \'YYYY\') }}</div><div class="daterangepicker__month">{{ _moment.clone().month(start.month).format(\'MMMM\') }}</div></h4><table><thead><tr><th ng-repeat="week in weeks">{{ week }}</th></tr></thead><tbody><tr ng-repeat="week in start.days"><td ng-repeat="day in week" ng-class="{ disabled: day.disabled, selected: !day.disabled &amp;&amp; (getMonthValue(start.value) === start.month) &amp;&amp; (day.value == start.value.format(\'D\')) }" ng-click="onSelectDay(\'start\', day, day.value, end.value.format(\'D\'))">{{ day.value }}</td></tr></tbody></table></div></div></div><div ng-bind="format.to" class="daterangepicker__to"></div><div class="daterangepicker__end"><input ng-if="useBrowserDefault" type="date" ng-model="end.value._d" class="daterangepicker__input"/><input ng-if="!useBrowserDefault" type="text" ng-value="end.value.format(format.date)" ng-click="toggleDropdown($event, \'end\')" readonly="" class="daterangepicker__input"/><div ng-show="end.show" ng-if="!useBrowserDefault" ng-click="$event.stopPropagation()" class="daterangepicker__dropdown"><button ng-click="onChangeMonth(\'end\', -1)" ng-if="start.month &lt; end.month" class="daterangepicker__prev">&lt;</button><button ng-click="onChangeMonth(\'end\', 1)" class="daterangepicker__next">&gt;</button><div class="daterangepicker__calendars"><h4 class="daterangepicker__year">{{ _moment.clone().month(end.month).format(locale.year || \'YYYY\') }}</h4><h4 class="daterangepicker__month">{{ _moment.clone().month(end.month).format(\'MMMM\') }}</h4><table><thead><tr><th ng-repeat="week in weeks">{{ week }}</th></tr></thead><tbody><tr ng-repeat="week in end.days"><td ng-repeat="day in week" ng-class="{ disabled: day.disabled, selected: !day.disabled &amp;&amp; (getMonthValue(end.value) === end.month) &amp;&amp; (day.value == end.value.format(\'D\')) }" ng-click="onSelectDay(\'end\', day, start.value.format(\'D\'), day.value)">{{ day.value }}</td></tr></tbody></table></div></div></div><button ng-click="applyDate()" class="daterangepicker__apply">{{ applyButtonLabel }}</button></div></div>',scope:{useBrowserDefault:"=",options:"=",initialRange:"=",locale:"=",rangeOptions:"=",format:"=",applyDateRange:"&",applyButtonLabel:"="},controller:"dateRangePickerController",link:function(t,n,a){angular.element(e).bind("click",function(){(t.start.show||t.end.show)&&(t.start.show=t.end.show=!1,t.resetMonth("start"),t.resetMonth("end"),t.$apply())}),t.$watch("useBrowserDefault",function(){t.useBrowserDefault&&angular.element(document).ready(function(){angular.element(document.querySelectorAll(".daterangepicker__input")).bind("change",function(){t.$apply()})})})}}}]);