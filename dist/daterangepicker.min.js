/*!
 * ng-daterangepicker.js
 * https://github.com/yuyaohshimo/ng-daterangepicker
 *
 * Copyright (c) 2014 Yuya Ohshimo
 * Licensed under the MIT license.
 */
(function(){angular.module("dateRangePicker",[]),angular.module("dateRangePicker").directive("dateRangePicker",["$window",function(e){return{restrict:"AE",replace:!0,template:'<div ng-click="$event.stopPropagation()" class="daterangepicker"><input type="text" readonly="" ng-click="toggleDropdown()" ng-show="!!dates" value="{{start.format(format.date ? format.date : \'YYYY/MM/DD\')}} {{format.to ? format.to : \'-\'}} {{end.format(format.date ? format.date : \'YYYY/MM/DD\')}}" class="daterangepicker__input"/><div ng-show="showDropdown" class="daterangepicker__dropdown"><div class="daterangepicker__header"><div class="daterangepicker__aside"><button ng-click="applyRange(rangeOption.value)" ng-repeat="rangeOption in rangeOptions">{{rangeOption.label}}</button></div><div class="daterangepicker__calendars"><button ng-click="prev()" class="daterangepicker__prev">&lt;</button><button ng-click="next()" class="daterangepicker__next">&gt;</button><div ng-repeat="calendarDaysArray in calendars" class="daterangepicker__calendar"><h4 ng-click="changeSelect(months[$index].value)" class="daterangepicker__month">{{months[$index].name}}</h4><table><thead><tr><th ng-repeat="week in weeks">{{week}}</th></tr></thead><tbody><tr ng-repeat="days in calendarDaysArray"><td ng-repeat="day in days track by $index" ng-class="{ \'daterangepicker_state_selected\': day.selected }" ng-click="select($parent.$parent.$index, day)">{{day.value}}</td></tr></tbody></table></div></div></div><div class="daterangepicker__footer"><button ng-click="ok()" class="daterangepicker__apply">OK</button><button ng-click="cancel()" class="daterangepicker__cancel">CANCEL</button></div></div></div>',scope:{dates:"=",locale:"=",monthNumbers:"=",rangeOptions:"=",format:"=",applyDateRange:"&"},link:function(t){var a,n,r,o,d,s,c,l=0,i=[];t.showDropdown=!1,t.start=t.dates.start,t.end=t.dates.end,t.calendars=[],t.months=[],angular.element(e).bind("click",function(){t.showDropdown&&(t.start=t.dates.start,t.end=t.dates.end,c(),t.$apply())}),t.locale&&moment.locale("dateRangePicker",{months:t.locale.months||moment.months(),weekdaysShort:t.locale.weekdaysShort||moment.weekdaysShort()}),document.querySelectorAll(".daterangepicker__dropdown")[0].style.top=document.querySelectorAll(".daterangepicker__input")[0].offsetHeight+"px",a=function(e,t,a,n){return e.hour(t).minute(a).second(n)},n=function(e){var t=[],a=moment().startOf("month").add(e,"month"),n=moment().endOf("month").add(e,"month"),r=moment().range(a,n);return r.by("days",function(e){t.push(e)}),t},_getFirstDay=function(e){return moment().startOf("month").add(e,"month").day()},r=function(e,t){var a=[];e.forEach(function(e,t){a.push({value:t+1})});for(var n=0;t>n;n++)a.unshift({value:""});return a},o=function(e){for(var t=[],a=0;e.length>0;a++)t.push(e.splice(0,7));return t},d=function(e){var a=n(e),d=_getFirstDay(e),s=r(a,d),c=o(s);t.calendars.push(c)},_createCalendars=function(){t.months=[],t.weeks=[],t.calendars=[],t.weeks=moment.weekdaysShort();for(var e=0+l,a=e-Math.floor(t.monthNumbers/2);a<e-Math.floor(t.monthNumbers/2)+t.monthNumbers;a++)t.months.push({name:moment().add(a,"month").format("MMMM"),value:a}),d(a);s()},s=function(){if(t.start){var e=t.start,n=t.end?t.end:moment(angular.extend({},t.start));if(e>n){var r=e;t.start=e=n,t.end=n=r}var o=moment().range(a(e,0,0,0),a(n,23,59,59));t.months.forEach(function(e,a){t.calendars[a].forEach(function(t){t.forEach(function(t){t.value&&(t.selected=o.contains(moment().startOf("month").add(e.value,"month").add(t.value-1,"day").hour(12).minute(0).second(0)))})})})}},c=function(){i=[],s(),t.showDropdown=!1},t.toggleDropdown=function(){t.showDropdown=!t.showDropdown},t.prev=function(){l--,_createCalendars()},t.next=function(){l++,_createCalendars()},t.ok=function(){c(),t.applyDateRange({start:t.start,end:t.end})},t.cancel=function(){t.start=t.dates.start,t.end=t.dates.end,c()},t.applyRange=function(e){i=["start","end"],t.start=e.start,t.end=e.end,s()},t.select=function(e,a){switch((a.selected||2===i.length)&&(t.start=null,t.end=null,i=[]),i.length){case 0:t.start=moment().startOf("month").add(t.months[e].value,"month").add(a.value-1,"day"),t.end=moment().startOf("month").add(t.months[e].value,"month").add(a.value-1,"day"),i.push("start");break;case 1:t.end=moment().startOf("month").add(t.months[e].value,"month").add(a.value-1,"day"),i.push("end")}s()},_createCalendars()}}}])}).call(this);