/*!
 * ng-daterangepicker.js
 * https://github.com/yuyaohshimo/ng-daterangepicker
 *
 * Copyright (c) 2014 Yuya Ohshimo
 * Licensed under the MIT license.
 */
(function(){angular.module("dateRangePicker",[]),angular.module("dateRangePicker").directive("dateRangePicker",["$window",function(e){return{restrict:"AE",replace:!0,template:'<div ng-click="$event.stopPropagation()" class="daterangepicker"><div class="daterangepicker__option"><select ng-model="selectedOption" ng-options="option.label for option in options" ng-change="onChangeSelect()" ng-click="onClickSelect()"></select></div><div ng-show="selectedOption.value === \'custom\'" class="daterangepicker__cutom"><div class="daterangepicker__start"><input ng-if="useBrowserDefault" type="date" ng-model="start.value._d" class="daterangepicker__input"/><input ng-if="!useBrowserDefault" type="text" ng-value="start.value.format(format.date)" ng-click="toggleDropdown(\'start\')" readonly="" class="daterangepicker__input"/><div ng-show="start.show" ng-if="!useBrowserDefault" class="daterangepicker__dropdown"><button ng-click="onChangeMonth(\'start\', -1)" class="daterangepicker__prev">&lt;</button><button ng-click="onChangeMonth(\'start\', 1)" ng-if="start.month &lt; end.month" class="daterangepicker__next">&gt;</button><div class="daterangepicker__calendars"><h4 class="daterangepicker__year">{{ _moment.clone().month(start.month).format(locale.year || \'YYYY\') }}</h4><h4 class="daterangepicker__month">{{ _moment.clone().month(start.month).format(\'MMMM\') }}</h4><table><thead><tr><th ng-repeat="week in weeks">{{ week }}</th></tr></thead><tbody><tr ng-repeat="week in start.days"><td ng-repeat="day in week" ng-class="{ disabled: day.disabled, selected: !day.disabled &amp;&amp; (start.value.month() === start.month) &amp;&amp; (day.value == start.value.format(\'D\')) }" ng-click="onSelectDay(\'start\', day, day.value, end.value.format(\'D\'))">{{ day.value }}</td></tr></tbody></table></div></div></div><div ng-bind="format.to" class="daterangepicker__to"></div><div class="daterangepicker__end"><input ng-if="useBrowserDefault" type="date" ng-model="end.value._d" class="daterangepicker__input"/><input ng-if="!useBrowserDefault" type="text" ng-value="end.value.format(format.date)" ng-click="toggleDropdown(\'end\')" readonly="" class="daterangepicker__input"/><div ng-show="end.show" ng-if="!useBrowserDefault" class="daterangepicker__dropdown"><button ng-click="onChangeMonth(\'end\', -1)" ng-if="start.month &lt; end.month" class="daterangepicker__prev">&lt;</button><button ng-click="onChangeMonth(\'end\', 1)" class="daterangepicker__next">&gt;</button><div class="daterangepicker__calendars"><h4 class="daterangepicker__year">{{ _moment.clone().month(end.month).format(locale.year || \'YYYY\') }}</h4><h4 class="daterangepicker__month">{{ _moment.clone().month(end.month).format(\'MMMM\') }}</h4><table><thead><tr><th ng-repeat="week in weeks">{{ week }}</th></tr></thead><tbody><tr ng-repeat="week in end.days"><td ng-repeat="day in week" ng-class="{ disabled: day.disabled, selected: !day.disabled &amp;&amp; (end.value.month() === end.month) &amp;&amp; (day.value == end.value.format(\'D\')) }" ng-click="onSelectDay(\'end\', day, start.value.format(\'D\'), day.value)">{{ day.value }}</td></tr></tbody></table></div></div></div></div></div>',scope:{useBrowserDefault:"=",options:"=",initialRange:"=",locale:"=",rangeOptions:"=",format:"=",applyDateRange:"&"},link:function(t){function n(e){var n=t.start,a=t.end;e&&(n=null,a=null),t.applyDateRange({start:n,end:a,option:t.selectedOption})}function a(e,n,a){var o="start"===a?t.start.month:t.start.value.month(),r="end"===a?t.end.month:t.end.value.month(),d=moment().clone().month(o).date(e),l=moment().clone().month(r).date(n);return l>=d}function o(e){t[e].month=t[e].value.month()}function r(){var e;return t.options.forEach(function(t){return t.selected?void(e=t):void 0}),e}function d(e){return"start"===e?"end":"start"}function l(e){for(var t=7,n=[],a=0;a<Math.ceil(e.length/t);a++){var o=a*t;n.push(e.slice(o,o+t))}return n}function s(e){for(var n=t[e].month,a=moment().month(n).startOf("month").day(),o=moment().month(n).endOf("month").date(),r=6-moment().month(n).endOf("month").day(),d=moment().month(n-1).endOf("month").format("D"),l=[];a>0;)l.push({value:d-a+1,disabled:!0}),a--;for(var s=1;o>=s;s++)l.push({value:s,disabled:!1});for(var i=1;r>=i;i++)l.push({value:i,disabled:!0});return l}t.locale&&moment.locale("dateRangePicker",{months:t.locale.months||moment.months(),weekdaysShort:t.locale.weekdaysShort||moment.weekdaysShort()}),angular.element(e).bind("click",function(){(t.start.show||t.end.show)&&(t.start.show=t.end.show=!1,o("start"),o("end"),t.$apply())}),t.$watch("useBrowserDefault",function(){t.useBrowserDefault&&angular.element(document).ready(function(){angular.element(document.querySelectorAll(".daterangepicker__input")).bind("change",function(){n(),t.$apply()})})}),t._moment=moment(),t.start={value:t.initialRange?t.initialRange.start:moment(),month:t.initialRange?t.initialRange.start.month():moment().month(),show:!1},t.end={value:t.initialRange?t.initialRange.end:moment(),month:t.initialRange?t.initialRange.end.month():moment().month(),show:!1},t.start.days=l(s("start")),t.end.days=l(s("end")),t.selectedOption=r(),t.weeks=moment.weekdaysShort(),t.onClickSelect=function(){t.start.show=t.end.show=!1,o("start"),o("end")},t.onChangeSelect=function(){if("custom"!==t.selectedOption.value){if("all"===t.selectedOption.value)return n(!0);t.start.value=t.selectedOption.start,t.start.month=t.start.value.month(),t.start.days=l(s("start")),t.end.value=t.selectedOption.end,t.end.month=t.end.value.month(),t.end.days=l(s("end")),n()}},t.onSelectDay=function(e,r,d,l){if(!r.disabled&&a(d,l,e)){var s=t[e].month;t[e].value=moment().month(s).date(r.value),t[e].show=!1,o(e),n()}},t.onChangeMonth=function(e,n){t[e].month+=n,t[e].days=l(s(e))},t.toggleDropdown=function(e){var n=d(e);t[n].show=!1,o(n),t[e].show=!t[e].show,t[e].show||o(e)}}}}])}).call(this);