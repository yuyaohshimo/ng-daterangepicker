/*!
 * ng-daterangepicker.js
 * https://github.com/yuyaohshimo/ng-daterangepicker
 *
 * Copyright (c) 2014 Yuya Ohshimo
 * Licensed under the MIT license.
 */
(function(){angular.module("dateRangePicker",[]),angular.module("dateRangePicker").directive("dateRangePicker",["$window",function(e){return{restrict:"AE",replace:!0,template:'<div ng-click="$event.stopPropagation()" class="daterangepicker"><input type="text" readonly="" ng-click="toggleDropdown()" ng-show="!!model" value="{{start.format(format.date ? format.date : \'YYYY/MM/DD\')}} {{format.to ? format.to : \'-\'}} {{end.format(format.date ? format.date : \'YYYY/MM/DD\')}}" class="daterangepicker__input"/><div ng-show="showDropdown" class="daterangepicker__dropdown"><div class="daterangepicker__header"><div class="daterangepicker__aside"><button ng-click="applyRange(rangeOption.value)" ng-repeat="rangeOption in rangeOptions">{{rangeOption.label}}</button></div><div class="daterangepicker__calendars"><button ng-click="prev()" class="daterangepicker__prev">&lt;</button><button ng-click="next()" class="daterangepicker__next">&gt;</button><div ng-repeat="calendarDaysArray in calendars" class="daterangepicker__calendar"><h4 ng-click="changeSelect(months[$index].value)" class="daterangepicker__month">{{months[$index].name}}</h4><table><thead><tr><th ng-repeat="week in weeks">{{week}}</th></tr></thead><tbody><tr ng-repeat="days in calendarDaysArray"><td ng-repeat="day in days track by $index" ng-class="{ \'daterangepicker_state_selected\': day.selected }" ng-click="select($parent.$parent.$index, day)">{{day.value}}</td></tr></tbody></table></div></div></div><div class="daterangepicker__footer"><button ng-click="ok()" class="daterangepicker__apply">OK</button><button ng-click="cancel()" class="daterangepicker__cancel">CANCEL</button></div></div></div>',scope:{model:"=ngModel",locale:"=",monthNumbers:"=",rangeOptions:"=",format:"="},link:function(t){var n,a,o,r,d,c,s,l=0,i=[];t.showDropdown=!1,t.start=t.model.start,t.end=t.model.end,t.calendars=[],t.months=[],angular.element(e).bind("click",function(){t.showDropdown&&(s(),t.$apply())}),t.locale&&moment.locale("dateRangePicker",{months:t.locale.months||moment.months(),weekdaysShort:t.locale.weekdaysShort||moment.weekdaysShort()}),document.querySelectorAll(".daterangepicker__dropdown")[0].style.top=document.querySelectorAll(".daterangepicker__input")[0].offsetHeight+"px",n=function(e,t,n,a){return e.hour(t).minute(n).second(a)},a=function(e){var t=[],n=moment().startOf("month").add(e,"month"),a=moment().endOf("month").add(e,"month"),o=moment().range(n,a);return o.by("days",function(e){t.push(e)}),t},_getFirstDay=function(e){return moment().startOf("month").add(e,"month").day()},o=function(e,t){var n=[];e.forEach(function(e,t){n.push({value:t+1})});for(var a=0;t>a;a++)n.unshift({value:""});return n},r=function(e){for(var t=[],n=0;e.length>0;n++)t.push(e.splice(0,7));return t},d=function(e){var n=a(e),d=_getFirstDay(e),c=o(n,d),s=r(c);t.calendars.push(s)},_createCalendars=function(){t.months=[],t.weeks=[],t.calendars=[],t.weeks=moment.weekdaysShort();for(var e=0+l,n=e-Math.floor(t.monthNumbers/2);n<e-Math.floor(t.monthNumbers/2)+t.monthNumbers;n++)t.months.push({name:moment().add(n,"month").format("MMMM"),value:n}),d(n);c()},c=function(){if(t.start){var e=t.start,a=t.end?t.end:moment(angular.extend({},t.start));if(e>a){var o=e;t.start=e=a,t.end=a=o}var r=moment().range(n(e,0,0,0),n(a,23,59,59));t.months.forEach(function(e,n){t.calendars[n].forEach(function(t){t.forEach(function(t){t.value&&(t.selected=r.contains(moment().startOf("month").add(e.value,"month").add(t.value-1,"day").hour(12).minute(0).second(0)))})})})}},s=function(){i=[],c(),t.showDropdown=!1},t.toggleDropdown=function(){t.showDropdown=!t.showDropdown},t.prev=function(){l--,_createCalendars()},t.next=function(){l++,_createCalendars()},t.ok=function(){s()},t.cancel=function(){t.start=t.model.start,t.end=t.model.end,s()},t.applyRange=function(e){i=["start","end"],t.start=e.start,t.end=e.end,c()},t.select=function(e,n){switch((n.selected||2===i.length)&&(t.start=null,t.end=null,i=[]),i.length){case 0:t.start=moment().startOf("month").add(t.months[e].value,"month").add(n.value-1,"day"),t.end=moment().startOf("month").add(t.months[e].value,"month").add(n.value-1,"day"),i.push("start");break;case 1:t.end=moment().startOf("month").add(t.months[e].value,"month").add(n.value-1,"day"),i.push("end")}c()},_createCalendars()}}}])}).call(this);