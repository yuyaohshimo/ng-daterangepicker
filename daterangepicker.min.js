/*
 * ng-daterangepicker.js
 * https://github.com/yuyaohshimo/ng-daterangepicker
 *
 * Copyright (c) 2014 Yuya Ohshimo
 * Licensed under the MIT license.
 */!function(){angular.module("dateRangePicker",[]),angular.module("dateRangePicker").directive("dateRangePicker",["$window",function(a){return{restrict:"AE",replace:!0,template:'<div class="daterangepicker" ng-click="$event.stopPropagation()"> <input class="daterangepicker__input" ng-click="toggleDropdown()" ng-show="!!model" value="{{start.format(format)}}-{{end.format(format)}}"> <div class="daterangepicker__dropdown" ng-show="showDropdown"> <div class="daterangepicker__header"> <div class="daterangepicker__aside"> <button ng-click="applyRange(rangeOption.value)" ng-repeat="rangeOption in rangeOptions">{{rangeOption.label}}</div><div class="daterangepicker__calendars"> <button class="daterangepicker__prev" ng-click="prev()"><</button> <button class="daterangepicker__next" ng-click="next()">></button> <div class="daterangepicker__calendar" ng-repeat="calendarDaysArray in calendars"> <h4 class="daterangepicker__month" ng-click="changeSelect(months[$index].value)">{{months[$index].name}}</h4> <table> <thead> <tr> <th ng-repeat="week in weeks">{{week}}</th> </tr></thead> <tbody> <tr ng-repeat="days in calendarDaysArray"> <td ng-repeat="day in days track by $index" ng-class="{\'daterangepicker_state_selected\': day.selected}" ng-click="select($parent.$parent.$index, day)">{{day.value}}</td></tr></tbody> </table> </div></div></div><div class="daterangepicker__footer"> <button class="daterangepicker__apply" ng-click="ok()">OK</button> <button class="daterangepicker__cancel" ng-click="cancel()">CANCEL</button> </div></div></div>',scope:{model:"=ngModel",locale:"=",monthNumbers:"=",rangeOptions:"="},link:function(b){var e,f,h,i,j,l,m,n=0,o=[];b.showDropdown=!1,b.start=b.model.start,b.end=b.model.end,b.calendars=[],b.months=[],angular.element(a).bind("click",function(){b.showDropdown&&(m(),b.$apply())}),b.locale&&moment.locale("dateRangePicker",{months:b.locale.months||moment.months(),weekdaysShort:b.locale.weekdaysShort||moment.weekdaysShort()}),e=function(a,b,c,d){return a.hour(b).minute(c).second(d)},f=function(a){var b=[],c=moment().startOf("month").add(a,"month"),d=moment().endOf("month").add(a,"month"),e=moment().range(c,d);return e.by("days",function(a){b.push(a)}),b},_getFirstDay=function(a){return moment().startOf("month").add(a,"month").day()},h=function(a,b){var c=[];a.forEach(function(a,b){c.push({value:b+1})});for(var d=0;b>d;d++)c.unshift({value:""});return c},i=function(a){for(var b=[],c=0;a.length>0;c++)b.push(a.splice(0,7));return b},j=function(a){var c=f(a),d=_getFirstDay(a),e=h(c,d),g=i(e);b.calendars.push(g)},_createCalendars=function(){b.months=[],b.weeks=[],b.calendars=[],b.weeks=moment.weekdaysShort();for(var a=0+n,c=a-Math.floor(b.monthNumbers/2);c<a-Math.floor(b.monthNumbers/2)+b.monthNumbers;c++)b.months.push({name:moment().add(c,"month").format("MMMM"),value:c}),j(c);l()},l=function(){if(b.start){var a=b.start,c=b.end?b.end:moment(angular.extend({},b.start));if(a>c){var d=a;b.start=a=c,b.end=c=d}var f=moment().range(e(a,0,0,0),e(c,23,59,59));b.months.forEach(function(a,c){b.calendars[c].forEach(function(b){b.forEach(function(b){b.value&&(b.selected=f.contains(moment().startOf("month").add(a.value,"month").add(b.value-1,"day").hour(12).minute(0).second(0)))})})})}},m=function(){o=[],l(),b.showDropdown=!1},b.toggleDropdown=function(){b.showDropdown=!b.showDropdown},b.prev=function(){n--,_createCalendars()},b.next=function(){n++,_createCalendars()},b.ok=function(){m()},b.cancel=function(){b.start=b.model.start,b.end=b.model.end,m()},b.applyRange=function(a){o=["start","end"],b.start=a.start,b.end=a.end,l()},b.select=function(a,c){switch((c.selected||2===o.length)&&(b.start=null,b.end=null,o=[]),o.length){case 0:b.start=moment().startOf("month").add(b.months[a].value,"month").add(c.value-1,"day"),b.end=moment().startOf("month").add(b.months[a].value,"month").add(c.value-1,"day"),o.push("start");break;case 1:b.end=moment().startOf("month").add(b.months[a].value,"month").add(c.value-1,"day"),o.push("end")}l()},_createCalendars()}}}])}.call(this);